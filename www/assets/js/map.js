var filterDsbMap="",filterGroup="";
function SmallManagerMap(){var c=this,e="",f="",l=[],g=[],h=!1,m=new google.maps.Marker,k=!1,n=new google.maps.MarkerImage("/css/images/active-marker.png",new google.maps.Size(20,20),new google.maps.Point(0,0),new google.maps.Point(10,10));c.init=function(){var b=c.getDefaultParams();b={disableDefaultUI:!0,scrollwheel:!0,navigationControl:!1,draggable:!0,mapTypeControl:!1,scaleControl:!1,zoomControl:!0,streetViewControl:!1,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.TOP_RIGHT},
zoom:b.zoom,center:new google.maps.LatLng(b.lat,b.lng),styles:[{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#444444"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#f2f2f2"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{saturation:-100},{lightness:45}]},{featureType:"road.highway",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.arterial",elementType:"labels.icon",
stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{color:"#dbeeeb"},{visibility:"on"}]}]};e=new google.maps.Map(document.getElementById("map"),b);c.getPois();k=!1;google.maps.event.addListener(e,"dragend",function(){k=!0;h||c.getPois();h=!1});google.maps.event.addListener(e,"zoom_changed",function(){k=!0;h||c.getPois();h=!1})};c.getDefaultParams=function(){var b={};c.updateFromHash();b.lat=0<parseFloat($("#lat").val())?
parseFloat($("#lat").val()):46.52863469527167;b.lng=0<parseFloat($("#lng").val())?parseFloat($("#lng").val()):2.43896484375;b.zoom=0<parseFloat($("#zoom").val())?parseFloat($("#zoom").val()):6;return b};c.updateFromHash=function(){var b=window.location.hash.replace("#","").split("\x26");0<b.length&&""!=b[0]&&$.each(b,function(a,b){a=b.split("\x3d");void 0!=$("#"+a[0]).val()&&$("#"+a[0]).val(decodeURIComponent(a[1]))})};c.getPois=function(){setTimeout(function(){f=e.getBounds();if(!f)return setTimeout(function(){c.getPois()},
100),!1;c.getData()},250)};c.getData=function(){g=[];var b=l;l=[];"projects"==filterDsbMap?$.when(c.getProjects()).done(function(a){h=!0;0!=a.gps.lat&&"false"==a.move&&(e.setCenter(new google.maps.LatLng(a.gps.lat,a.gps.lng)),e.setZoom(parseInt(a.gps.zoom)));c.updateData(g);k=!1}):"talents"==filterDsbMap?$.when(c.getTalents(0)).done(function(a){h=!0;0!=a.gps.lat&&"false"==a.move&&(e.setCenter(new google.maps.LatLng(a.gps.lat,a.gps.lng)),e.setZoom(parseInt(a.gps.zoom)));c.updateData(g);k=!1}):"group"==
filterDsbMap?$.when(c.getGroups()).done(function(a){h=!0;0!=a.gps.lat&&"false"==a.move&&(e.setCenter(new google.maps.LatLng(a.gps.lat,a.gps.lng)),e.setZoom(parseInt(a.gps.zoom)));c.updateData(g);k=!1}):"dialog"==filterDsbMap?$.when(c.getDialogs()).done(function(a){h=!0;0!=a.gps.lat&&"false"==a.move&&(e.setCenter(new google.maps.LatLng(a.gps.lat,a.gps.lng)),e.setZoom(parseInt(a.gps.zoom)));c.updateData(g);k=!1}):"jobs"==filterDsbMap?$.when(c.getJobs()).done(function(a){h=!0;0!=a.gps.lat&&"false"==
a.move&&(e.setCenter(new google.maps.LatLng(a.gps.lat,a.gps.lng)),e.setZoom(parseInt(a.gps.zoom)));c.updateData(g);k=!1}):"teachers"==filterDsbMap?$.when(c.getTalents(1)).done(function(a){h=!0;0!=a.gps.lat&&"false"==a.move&&(e.setCenter(new google.maps.LatLng(a.gps.lat,a.gps.lng)),e.setZoom(parseInt(a.gps.zoom)));c.updateData(g);k=!1}):"coachs"==filterDsbMap?$.when(c.getTalents(2)).done(function(a){h=!0;0!=a.gps.lat&&"false"==a.move&&(e.setCenter(new google.maps.LatLng(a.gps.lat,a.gps.lng)),e.setZoom(parseInt(a.gps.zoom)));
c.updateData(g);k=!1}):"courses"==filterDsbMap?$.when(c.getTalents(1)).done(function(a){c.updateData(g)}):$.when(c.getTalents(0),c.getProjects(),c.getGroups(),c.getDialogs(),c.getJobs(),c.getTools()).done(function(a,b,d,f){h=!0;0!=a[0].gps.lat&&"false"==a[0].move?(e.setCenter(new google.maps.LatLng(a[0].gps.lat,a[0].gps.lng)),e.setZoom(parseInt(a[0].gps.zoom))):0!=b[0].gps.lat&&"false"==b[0].move?(e.setCenter(new google.maps.LatLng(b[0].gps.lat,b[0].gps.lng)),e.setZoom(parseInt(b[0].gps.zoom))):0!=
b[0].gps.lat&&"false"==b[0].move?(e.setCenter(new google.maps.LatLng(b[0].gps.lat,b[0].gps.lng)),e.setZoom(parseInt(b[0].gps.zoom))):0!=d[0].gps.lat&&"false"==d[0].move&&(e.setCenter(new google.maps.LatLng(d[0].gps.lat,d[0].gps.lng)),e.setZoom(parseInt(d[0].gps.zoom)));c.updateData(g);k=!1});h=!1;c.removePois(b)};c.updateData=function(b){var a=parseInt(e.getZoom())-1;6<=a&&(2>b.length&&""==$("input[name\x3dsearch]").val()||1>b.length&&""!=$("input[name\x3dsearch]").val()||1>b.length&&""!=filterDsbMap)&&
e.setZoom(a);b.sort(function(a,b){return a.order>b.order?1:b.order>a.order?-1:0});c.updateListData(b.slice(0,50))};c.updateListData=function(b){$("#itemList").html("");$.each(b,function(a,b){a="jobs"==b.type?$("#jobListTemplate").html():"projects"==b.type?$("#projectListTemplate").html():"teaching"==b.type?$("#teachingListTemplate").html():"tool"==b.type?$("#toolListTemplate").html():"dialog"==b.type?$("#dialogListTemplate").html():"group"==b.type?$("#groupListTemplate").html():$("#talentListTemplate").html();
$("#itemList").append(Mustache.to_html(a,b))});badgeOver();loadShutter()};c.getTools=function(){return $.getJSON("/Search/json/",{limit:25,search:$("input[name\x3dsearch]").val()},function(b){$.each(b.data,function(b,c){c.type="tool";g.push(c)})})};c.getGroups=function(){var b=new google.maps.MarkerImage("/css/images/regular-groups.png",new google.maps.Size(20,20),new google.maps.Point(0,0),new google.maps.Point(10,10));return $.getJSON("/group/json_group/",{slt:parseFloat(f.getSouthWest().lat()),
slg:parseFloat(f.getSouthWest().lng()),nlt:parseFloat(f.getNorthEast().lat()),nlg:parseFloat(f.getNorthEast().lng()),specific:filterDsbMap,group:filterGroup,skill:$("#skill").val(),limit:150,search:$("input[name\x3dsearch]").val()},function(a){$.each(a.data,function(a,d){a=new google.maps.Marker({position:new google.maps.LatLng(d.lat,d.lng),map:e,icon:b,regular:b,title:d.title,zIndex:1,userId:d.id,img:d.img,link:d.link,page:"group"});l.push(a);d.type="group";g.push(d);google.maps.event.addListener(a,
"mouseover",function(){c.markerHover(this)});google.maps.event.addListener(a,"mouseout",function(){c.markerOut(this)});google.maps.event.addListener(a,"click",function(){window.location=this.link})})})};c.getDialogs=function(){var b=new google.maps.MarkerImage("/css/images/regular-dialog.png",new google.maps.Size(20,20),new google.maps.Point(0,0),new google.maps.Point(10,10));return $.getJSON("/dialog/json/",{slt:parseFloat(f.getSouthWest().lat()),slg:parseFloat(f.getSouthWest().lng()),nlt:parseFloat(f.getNorthEast().lat()),
nlg:parseFloat(f.getNorthEast().lng()),specific:filterDsbMap,group:filterGroup,skill:$("#skill").val(),limit:150,search:$("input[name\x3dsearch]").val()},function(a){$.each(a.data,function(a,d){a=new google.maps.Marker({position:new google.maps.LatLng(d.lat,d.lng),map:e,icon:b,regular:b,title:d.title,zIndex:1,userId:d.id,img:d.img,link:d.link,page:"dialog"});l.push(a);d.type="dialog";g.push(d);google.maps.event.addListener(a,"mouseover",function(){c.markerHover(this)});google.maps.event.addListener(a,
"mouseout",function(){c.markerOut(this)});google.maps.event.addListener(a,"click",function(){window.location=this.link})})})};c.getTalents=function(b){var a="talents";1==b&&(a="teaching");2==b&&(a="teaching");var p=new google.maps.MarkerImage("/css/images/regular-"+a+".png",new google.maps.Size(20,20),new google.maps.Point(0,0),new google.maps.Point(10,10));return $.getJSON("/User/json/",{slt:parseFloat(f.getSouthWest().lat()),slg:parseFloat(f.getSouthWest().lng()),nlt:parseFloat(f.getNorthEast().lat()),
nlg:parseFloat(f.getNorthEast().lng()),skill:$("#skill").val(),teaching:b,group:filterGroup,specific:filterDsbMap,limit:150,search:$("input[name\x3dsearch]").val(),move:k},function(b){$.each(b.data,function(b,d){b=new google.maps.Marker({position:new google.maps.LatLng(d.lat,d.lng),map:e,icon:p,regular:p,title:d.nickname,zIndex:1,userId:d.id,img:d.img,link:d.link,page:"talents"});l.push(b);d.type=a;g.push(d);google.maps.event.addListener(b,"mouseover",function(){c.markerHover(this)});google.maps.event.addListener(b,
"mouseout",function(){c.markerOut(this)});google.maps.event.addListener(b,"click",function(){window.location=this.link})})})};c.getProjects=function(){var b=new google.maps.MarkerImage("/css/images/regular-projects.png",new google.maps.Size(20,20),new google.maps.Point(0,0),new google.maps.Point(10,10));return $.getJSON("/Project/json/",{slt:parseFloat(f.getSouthWest().lat()),slg:parseFloat(f.getSouthWest().lng()),nlt:parseFloat(f.getNorthEast().lat()),nlg:parseFloat(f.getNorthEast().lng()),specific:filterDsbMap,
group:filterGroup,skill:$("#skill").val(),limit:150,search:$("input[name\x3dsearch]").val()},function(a){$.each(a.data,function(a,d){a=new google.maps.Marker({position:new google.maps.LatLng(d.lat,d.lng),map:e,icon:b,regular:b,title:d.name,zIndex:1E3+parseInt(a),userId:d.id,img:d.img,link:d.link,page:"projects"});l.push(a);d.type="projects";g.push(d);google.maps.event.addListener(a,"mouseover",function(){c.markerHover(this)});google.maps.event.addListener(a,"mouseout",function(){c.markerOut(this)});
google.maps.event.addListener(a,"click",function(){window.location=this.link})})})};c.getJobs=function(){var b=new google.maps.MarkerImage("/css/images/regular-jobs.png",new google.maps.Size(20,20),new google.maps.Point(0,0),new google.maps.Point(10,10));return $.getJSON("/Job/json/",{slt:parseFloat(f.getSouthWest().lat()),slg:parseFloat(f.getSouthWest().lng()),nlt:parseFloat(f.getNorthEast().lat()),nlg:parseFloat(f.getNorthEast().lng()),specific:filterDsbMap,group:filterGroup,skill:$("#skill").val(),
limit:150,search:$("input[name\x3dsearch]").val()},function(a){$.each(a.data,function(a,d){a=new google.maps.Marker({position:new google.maps.LatLng(d.lat,d.lng),map:e,icon:b,regular:b,title:d.name,zIndex:1E3+parseInt(a),userId:d.id,img:d.img,link:d.link,page:"jobs"});l.push(a);d.type="jobs";g.push(d);google.maps.event.addListener(a,"mouseover",function(){c.markerHover(this)});google.maps.event.addListener(a,"mouseout",function(){c.markerOut(this)});google.maps.event.addListener(a,"click",function(){window.location=
this.link})})})};c.markerHover=function(b){b.setIcon(n);var a=c.latLngToPoint(b.position);"talents"==b.page&&$("#rollover").hide().css({top:parseInt(a.y-85)+"px",left:parseInt(a.x-35)+"px"}).html('\x3cimg class\x3d"img-circle" width\x3d"70" height\x3d"70" title\x3d"Voir la fiche de '+b.title+'" alt\x3d"Voir la fiche de '+b.title+'" src\x3d"'+b.img+'" style\x3d"border:solid 2px #ffffff;" /\x3e').fadeIn(350);"projects"!=b.page&&"jobs"!=b.page||$("#rollover").hide().css({top:parseInt(a.y-40)+"px",left:parseInt(a.x-
250)+"px"}).html('\x3cdiv class\x3d"mapHoverProject"\x3e\x3cspan\x3e'+b.title+"\x3c/span\x3e\x3c/div\x3e").fadeIn(350)};c.markerOut=function(b){b.setIcon(b.regular);$("#rollover").hide().css({top:"-9999px",left:"-9999px"})};c.latLngToPoint=function(b){var a=Math.pow(2,e.getZoom()),c=new google.maps.LatLng(e.getBounds().getNorthEast().lat(),e.getBounds().getSouthWest().lng());c=e.getProjection().fromLatLngToPoint(c);b=e.getProjection().fromLatLngToPoint(b);return new google.maps.Point(Math.floor((b.x-
c.x)*a),Math.floor((b.y-c.y)*a))};c.addLocateIcon=function(b,a){b={position:new google.maps.LatLng(b,a),map:e,icon:n,title:"Ici",zIndex:1E5};m.setOptions(b)};c.removeLocateIcon=function(b,a){m.setMap(null)};c.removePois=function(b){$.each(b,function(a,b){b.setMap(null)})}};